// Generated by CoffeeScript 1.10.0
(function() {
  angular.module('InterCityBus').controller('SearchController', function($state, $scope, $window, $stateParams, $http, $timeout, City, Hotline, Busline, Utils) {
    $scope.cities = City.query();
    $scope.startCityId = $stateParams.start;
    $scope.endCityId = $stateParams.end;
    $scope.buslines = Busline.query({
      start: $stateParams.start,
      end: $stateParams.end
    }, function() {
      return $scope.showNoResult = $scope.buslines.length === 0;
    });
    $scope.viewDetailBusline = function(id) {
      return $state.go('busline', {
        id: id
      });
    };
    angular.element($window).bind('orientationchange', function() {
      return $timeout(function() {
        return Utils.fixTooLongIssue();
      }, 500);
    });
    angular.element($window).bind('resize', function() {
      return $timeout(function() {
        return Utils.fixTooLongIssue();
      }, 500);
    });
    $scope.$on('$viewContentLoaded', function(event) {
      $timeout(function() {
        return Utils.fixTooLongIssue();
      }, 100);
      $timeout(function() {
        return Utils.fixTooLongIssue();
      }, 500);
      return $timeout(function() {
        return Utils.fixTooLongIssue();
      }, 2000);
    });
    $scope.research = function() {
      return $state.go('index');
    };
    return $scope.requestNewLine = function() {
      var end, msg, requestline, start;
      start = $scope.cities[$scope.startCityId].name;
      end = $scope.cities[$scope.endCityId].name;
      msg = "您专属定制的" + start + "-" + end + "的路线小巴已经收到，将会尽快开通，届时将第一时间通知您！";
      requestline = new Hotline();
      requestline.startCityId = $scope.startCityId;
      requestline.endCityId = $scope.endCityId;
      console.log($scope.startCityId);
      requestline.$save(function() {
        return alert(msg);
      });
      return $state.go('index');
    };
  });

}).call(this);

//# sourceMappingURL=search.controller.js.map
