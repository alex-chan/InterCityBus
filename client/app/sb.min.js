(function(){var t;t=angular.module("InterCityBus",["ui.router","ngCookies","ngResource","InterCityBus.services","InterCityBus.controllers"]).config(["$stateProvider","$urlRouterProvider","$locationProvider","$httpProvider",function(t,e,n,r){return n.html5Mode(!0),r.interceptors.push("authInterceptor")}]).factory("authInterceptor",["$rootScope","$q","$cookies","$injector",function(t,e,n,r){return{request:function(t){return t.headers=t.headers||{},n.get("token")&&(t.headers.Authorization="Bearer "+n.get("token")),t},responseError:function(t){var i;return 401===t.status?((i||(i=r.get("$state"))).go("login"),n.remove("token"),e.reject(t)):e.reject(t)}}}]).run(["$rootScope","$state",function(t,e){return t.$on("$stateChangeStart",function(t,n){return console.log(n),console.log(n.url),"/"===n.url?(t.preventDefault(),e.go("search")):void 0})}]),angular.module("InterCityBus.services",[]),angular.module("InterCityBus.controllers",[])}).call(this),function(){angular.module("InterCityBus").controller("BuslineController",["$scope","$window","$document","$stateParams","$http","$timeout","$interval","Busline","Utils",function(t,e,n,r,i,o,u,s,a){return t.dial=function(n){var r;return o(function(){return t.finishBook=!0},5e3),r=e.open("tel:"+n),!1},t.purify=function(t){return t.replace(/\s+/g,"")},t.busline=s.get({id:r.id}),t.$on("$viewContentLoaded",function(t){return o(function(){return a.fixTooLongIssue()},100),o(function(){return a.fixTooLongIssue()},500),o(function(){return a.fixTooLongIssue()},2e3)}),t.closeit=function(){return t.finishBook=!1},t.shareit=function(){return t.shareIt=!0,o(function(){return t.shareIt=!1},1e4)}}])}.call(this),function(){angular.module("InterCityBus").config(["$stateProvider",function(t){return t.state("busline",{url:"/busline/:id",templateUrl:"app/busline/busline.html",controller:"BuslineController"})}]),angular.module("InterCityBus.services").factory("Busline",["$resource",function(t){return t("/api/buslines/:id",{id:"@id"},{update:{method:"PUT"}})}])}.call(this),function(){angular.module("InterCityBus").controller("FeedbackController",["$scope","$http",function(t,e){return t.submitFeedback=function(){return alert("您的反馈我们已经收到！")}}])}.call(this),function(){angular.module("InterCityBus").config(["$stateProvider",function(t){return t.state("feedback",{url:"/feedback",templateUrl:"app/feedback/feedback.html",controller:"FeedbackController"})}])}.call(this),function(){angular.module("InterCityBus").controller("IndexController",["$state","$rootScope","$scope","$timeout","$http","City","Hotline",function(t,e,n,r,i,o,u){return n.$on("$stateChangeSuccess",function(t,e,r,i,o){return"index"===e.name&&o.start&&o.end?n.cities.$promise.then(function(){return n.startCity=n.cities[o.start-1],n.endCity=n.cities[o.end-1]}):void 0}),n.swapCity=function(){var t;return t=this.startCity,this.startCity=this.endCity,this.endCity=t},n.cities=o.query(),n.hotlines=u.query({limit:6}),n.search=function(e,n){return t.go("search",{start:e,end:n})},n.searchBusline=function(){return this.startCity&&this.endCity?this.startCity.id===this.endCity.id?void alert("出发地和终点地不能一样哦"):t.go("search",{start:this.startCity.id,end:this.endCity.id}):void alert("必须选好出发和终点城市哦")}}])}.call(this),function(){angular.module("InterCityBus").config(["$stateProvider",function(t){return t.state("index",{url:"/index",templateUrl:"app/index/index.html",controller:"IndexController"})}]),angular.module("InterCityBus.services").factory("City",["$resource",function(t){return t("/api/cities/:id",{id:"@id"},{update:{method:"PUT"}})}]).factory("Hotline",["$resource",function(t){return t("/api/hotlines/:id",{id:"@id"})}])}.call(this),function(){angular.module("InterCityBus").controller("SearchController",["$state","$scope","$window","$stateParams","$http","$timeout","City","Hotline","Busline","Utils",function(t,e,n,r,i,o,u,s,a,l){return e.cities=u.query(),e.startCityId=r.start,e.endCityId=r.end,e.buslines=a.query({start:r.start,end:r.end},function(){return e.showNoResult=0===e.buslines.length}),e.viewDetailBusline=function(e){return t.go("busline",{id:e})},angular.element(n).bind("orientationchange",function(){return o(function(){return l.fixTooLongIssue()},500)}),angular.element(n).bind("resize",function(){return o(function(){return l.fixTooLongIssue()},500)}),e.$on("$viewContentLoaded",function(t){return o(function(){return l.fixTooLongIssue()},100),o(function(){return l.fixTooLongIssue()},500),o(function(){return l.fixTooLongIssue()},2e3)}),e.research=function(){return t.go("index")},e.requestNewLine=function(){var n,r,i,o;return o=e.cities[e.startCityId-1].name,n=e.cities[e.endCityId-1].name,r="您专属定制的"+o+"-"+n+"的路线小巴已经收到，将会尽快开通，届时将第一时间通知您！",i=new s,i.startCityId=e.startCityId,i.endCityId=e.endCityId,console.log(e.startCityId),i.$save(function(){return alert(r)}),t.go("index")}}])}.call(this),function(){angular.module("InterCityBus").config(["$stateProvider",function(t){return t.state("search",{url:"/search?start&end",templateUrl:"app/search/search.html",controller:"SearchController"})}]),angular.module("InterCityBus.services").factory("Utils",function(){return{fixTooLongIssue:function(){var t;t=$(".line_name"),angular.forEach(t,function(t,e){var n,r;return n=$(t).find("ul[class='start']").width(),r=$(t).find("ul[class='end']").width(),$(t).css("min-width",n+r)})}}})}.call(this);