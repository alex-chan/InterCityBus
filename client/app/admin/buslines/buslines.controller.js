// Generated by CoffeeScript 1.10.0
(function() {
  angular.module('InterCityBus.controllers').controller('BuslineListCtrl', function($state, $scope, $http, $window, Busline) {
    $scope.buslines = Busline.query();
    return $scope.deleteBusline = function(busline) {
      return busline.$remove(function() {
        return $state.go($state.current, {}, {
          reload: true
        });
      });
    };
  }).controller('BuslineViewCtrl', function($scope, $stateParams, Busline) {
    return $scope.busline = Busline.get({
      id: $stateParams.id
    });
  }).controller('BuslineCreateCtrl', function($scope, $state, $stateParams, Busline, City, Company, Station, Starttime, Phone) {
    $scope.cities = City.query();
    $scope.companies = Company.query();
    $scope.stations = Station.query();
    $scope.busline = new Busline();
    $scope.starttimes = Starttime.query();
    $scope.phones = Phone.query();
    $scope.addPhoneToDb = function(phoneNumber) {
      var phone;
      phone = new Phone();
      phone.phoneNumber = phoneNumber;
      return phone.$save(function() {
        return $scope.phones = Phone.query(function() {
          return $scope.busline.phones.push(phone);
        });
      });
    };
    $scope.addBusline = function() {
      return $scope.busline.$save(function() {
        return $state.go("buslines");
      });
    };
    $scope.addPhone = function(index) {
      if (!$scope.busline.phones) {
        $scope.busline.phones = [];
      }
      if ($scope.busline.phones.indexOf(this.phoneToAdd[index]) === -1) {
        return $scope.busline.phones.splice(index, 0, this.phoneToAdd[index]);
      }
    };
    $scope.addStationToCity = function(cityId, stationName) {
      var self;
      if (!stationName) {
        alert("请先填写站点名");
        return;
      }
      self = this;
      return angular.forEach($scope.cities, function(val, key) {
        var station;
        if (val.id === cityId) {
          station = new Station();
          station.name = stationName;
          station.cityId = cityId;
          return station.$save(function() {
            alert("增加成功");
            return $scope.stations = Station.query();
          });
        }
      });
    };
    $scope.addStarttime = function(index) {
      if (!$scope.busline.StartTime) {
        $scope.busline.StartTime = [];
      }
      if ($scope.busline.StartTime.indexOf(this.starttimeToAdd[index]) === -1) {
        return $scope.busline.StartTime.splice(index, 0, this.starttimeToAdd[index]);
      }
    };
    $scope.addStation = function(index, isEndCity) {
      var startStations, toAddStation, toInsertPos;
      toInsertPos = index;
      if (!this.busline.endCityId || !this.busline.endCityId) {
        alert("请先选择好出发和终点城市");
        return;
      }
      if ((isEndCity && !this.stationToAdd2) || (!isEndCity && !this.stationToAdd)) {
        alert("请先选择好站点再添加");
        return;
      }
      if (!$scope.busline.stations) {
        $scope.busline.stations = [];
      }
      if (isEndCity) {
        startStations = $scope.busline.stations.filter(function(item) {
          if (item.cityId === $scope.busline.startCityId) {
            return true;
          } else {
            return false;
          }
        });
        toInsertPos += startStations.length;
        toAddStation = this.stationToAdd2[index];
      } else {
        toAddStation = this.stationToAdd[index];
      }
      if ($scope.busline.stations.indexOf(toAddStation) === -1) {
        return $scope.busline.stations.splice(toInsertPos, 0, toAddStation);
      }
    };
    $scope.delPhone = function(index) {
      return $scope.busline.phones.splice(index, 1);
    };
    $scope.delStarttime = function(index) {
      return $scope.busline.StartTime.splice(index, 1);
    };
    return $scope.delStation = function(index, isEndCity) {
      var startStations, toInsertPos;
      toInsertPos = index;
      if (isEndCity) {
        startStations = $scope.busline.stations.filter(function(item) {
          if (item.cityId === $scope.busline.startCityId) {
            return true;
          } else {
            return false;
          }
        });
        toInsertPos += startStations.length;
      }
      $scope.busline.stations.splice(toInsertPos, 1);
    };
  }).controller('BuslineEditCtrl', function($scope, $state, $stateParams, Busline, City, Company, Station, Starttime, Phone) {
    $scope.cities = City.query();
    $scope.companies = Company.query();
    $scope.stations = Station.query();
    $scope.starttimes = Starttime.query();
    $scope.phones = Phone.query();
    $scope.addPhoneToDb = function(phoneNumber) {
      var phone;
      phone = new Phone();
      phone.phoneNumber = phoneNumber;
      return phone.$save(function() {
        return $scope.phones = Phone.query(function() {
          return $scope.busline.phones.push(phone);
        });
      });
    };
    $scope.addPhone = function(index) {
      if (!$scope.busline.phones) {
        $scope.busline.phones = [];
      }
      if ($scope.busline.phones.indexOf(this.phoneToAdd[index]) === -1) {
        return $scope.busline.phones.splice(index, 0, this.phoneToAdd[index]);
      }
    };
    $scope.delPhone = function(index) {
      return $scope.busline.phones.splice(index, 1);
    };
    $scope.addStarttime = function(index) {
      if (!$scope.busline.StartTime) {
        $scope.busline.StartTime = [];
      }
      if ($scope.busline.StartTime.indexOf(this.starttimeToAdd[index]) === -1) {
        return $scope.busline.StartTime.splice(index, 0, this.starttimeToAdd[index]);
      }
    };
    $scope.delStarttime = function(index) {
      return $scope.busline.StartTime.splice(index, 1);
    };
    $scope.addStationToCity = function(cityId, stationName) {
      var self;
      if (!stationName) {
        alert("请先填写站点名");
        return;
      }
      self = this;
      return angular.forEach($scope.cities, function(val, key) {
        var station;
        if (val.id === cityId) {
          station = new Station();
          station.name = stationName;
          station.cityId = cityId;
          return station.$save(function() {
            alert("增加成功");
            return $scope.stations = Station.query();
          });
        }
      });
    };
    $scope.addStation = function(index, isEndCity) {
      var startStations, toAddStation, toInsertPos;
      toInsertPos = index;
      if (isEndCity) {
        startStations = $scope.busline.stations.filter(function(item) {
          if (item.cityId === $scope.busline.startCityId) {
            return true;
          } else {
            return false;
          }
        });
        toInsertPos += startStations.length;
        toAddStation = this.stationToAdd2[index];
      } else {
        toAddStation = this.stationToAdd[index];
      }
      if ($scope.busline.stations.indexOf(toAddStation) === -1) {
        return $scope.busline.stations.splice(toInsertPos, 0, toAddStation);
      }
    };
    $scope.delStation = function(index, isEndCity) {
      var startStations, toInsertPos;
      toInsertPos = index;
      if (isEndCity) {
        startStations = $scope.busline.stations.filter(function(item) {
          if (item.cityId === $scope.busline.startCityId) {
            return true;
          } else {
            return false;
          }
        });
        toInsertPos += startStations.length;
      }
      $scope.busline.stations.splice(toInsertPos, 1);
    };
    $scope.loadBusline = function() {
      $scope.updateBusline = function() {
        return $scope.busline.$update(function() {
          return $state.go("buslines");
        });
      };
      return $scope.busline = Busline.get({
        id: $stateParams.id
      });
    };
    return $scope.loadBusline();
  });

}).call(this);

//# sourceMappingURL=buslines.controller.js.map
